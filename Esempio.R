library(flexdashboard)
library(dplyr)
library(ggplot2)
library(readxl)
library(tidyr)
library(plotly)
library(MALDIquant)
library(DT)
library(shiny)
library(shinythemes)
library(scales)
todo <- structure(list(MESES = c(6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 
                                 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 
                                 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 
                                 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 
                                 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 
                                 80, 81, 82, 83, 84), `FECHA SOLICITUD` = structure(c(1650844800, 
                                                                                      1650844800, 1650844800, 1650844800, 1650844800, 1650844800, 1650844800, 
                                                                                      1650844800, 1650844800, 1650844800, 1650844800, 1650844800, 1650844800, 
                                                                                      1651449600, 1654128000, 1656892800, 1659398400, 1662076800, 1664755200, 
                                                                                      1667347200, 1669939200, 1672617600, 1675296000, 1677715200, 1680480000, 
                                                                                      1682985600, 1685664000, 1688342400, 1690934400, 1693785600, 1696204800, 
                                                                                      1698883200, 1701648000, 1704153600, 1706832000, 1709510400, 1712016000, 
                                                                                      1714608000, 1717372800, 1719878400, 1722556800, 1725235200, 1727827200, 
                                                                                      1730678400, 1733097600, 1735776000, 1738540800, 1740960000, 1743552000, 
                                                                                      1746144000, 1748822400, 1751414400, 1754265600, 1756771200, 1759363200, 
                                                                                      1762128000, 1764633600, 1767312000, 1769990400, 1772409600, 1775088000, 
                                                                                      1777852800, 1780358400, 1782950400, 1785715200, 1788307200, 1790899200, 
                                                                                      1793577600, 1796169600, 1799020800, 1801526400, 1803945600, 1806624000, 
                                                                                      1809302400, 1811894400, 1814486400, 1817164800, 1819843200, 1822608000
                                 ), class = c("POSIXct", "POSIXt"), tzone = "UTC"), `EDAD AL PENSIONARSE` = c(60.0054757015743, 
                                                                                                              60.0054757015743, 60.0054757015743, 60.0054757015743, 60.0054757015743, 
                                                                                                              60.0054757015743, 60.0054757015743, 60.0054757015743, 60.0054757015743, 
                                                                                                              60.0054757015743, 60.0054757015743, 60.0054757015743, 60.0054757015743, 
                                                                                                              60.0246406570842, 60.1095140314853, 60.1971252566735, 60.2765229295003, 
                                                                                                              60.3613963039014, 60.4462696783025, 60.5284052019165, 60.6105407255305, 
                                                                                                              60.6954140999316, 60.7802874743326, 60.8569472963723, 60.9445585215606, 
                                                                                                              61.0239561943874, 61.1088295687885, 61.1937029431896, 61.2758384668036, 
                                                                                                              61.3661875427789, 61.4428473648186, 61.5277207392197, 61.6153319644079, 
                                                                                                              61.6947296372348, 61.7796030116359, 61.864476386037, 61.9438740588638, 
                                                                                                              62.0260095824778, 62.113620807666, 62.1930184804928, 62.2778918548939, 
                                                                                                              62.362765229295, 62.444900752909, 62.5352498288843, 62.611909650924, 
                                                                                                              62.6967830253251, 62.7843942505133, 62.861054072553, 62.943189596167, 
                                                                                                              63.025325119781, 63.1101984941821, 63.192334017796, 63.2826830937714, 
                                                                                                              63.3620807665982, 63.4442162902122, 63.5318275154004, 63.6112251882272, 
                                                                                                              63.6960985626283, 63.7809719370294, 63.8576317590691, 63.9425051334702, 
                                                                                                              64.0301163586584, 64.1095140314853, 64.1916495550992, 64.2792607802875, 
                                                                                                              64.3613963039014, 64.4435318275154, 64.5284052019165, 64.6105407255305, 
                                                                                                              64.7008898015058, 64.7802874743327, 64.8569472963724, 64.9418206707734, 
                                                                                                              65.0266940451745, 65.1088295687885, 65.1909650924025, 65.2758384668036, 
                                                                                                              65.3607118412046, 65.4483230663929), `25 UMAS-SALARIO DIARIO: $2,172.00` = c(7003.69300000001, 
                                                                                                                                                                                           7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                                                           7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                                                           7003.69300000001, 7003.69300000001, 7003.69300000001, 7313.10349166418, 
                                                                                                                                                                                           7662.92692435524, 8334.77806971132, 8698.25994718474, 9070.92111700822, 
                                                                                                                                                                                           9446.97086786907, 9809.84934854836, 10180.7506110556, 10542.8245626761, 
                                                                                                                                                                                           10917.466387684, 11288.3676501913, 12062.146335786, 12450.8659594329, 
                                                                                                                                                                                           12822.6643301992, 13689.8450135198, 14079.1300443265, 14477.9057882185, 
                                                                                                                                                                                           14880.7032105046, 15269.9882413113, 16646.5774591975, 17057.4221576118, 
                                                                                                                                                                                           17477.6580769748, 17902.8596913359, 18938.9109732444, 19373.8341679632, 
                                                                                                                                                                                           19799.0379178912, 20922.5710120632, 21356.8210157181, 21811.7442835795, 
                                                                                                                                                                                           22266.667551441, 22700.9175550959, 24515.6983515438, 24976.6162781308, 
                                                                                                                                                                                           25447.0475351234, 25924.2294849782, 27213.4715976204, 27699.2702756748, 
                                                                                                                                                                                           28175.2448545303, 29574.8789976969, 30058.7184906917, 30321.560712375, 
                                                                                                                                                                                           30321.560712375, 30321.560712375, 32006.0918630625, 32006.0918630625, 
                                                                                                                                                                                           32006.0918630625, 32006.0918630625, 32987.5051930313, 32987.5051930313, 
                                                                                                                                                                                           32987.5051930313, 33968.918523, 33968.918523, 33968.918523, 33968.918523, 
                                                                                                                                                                                           33968.918523, 35756.75634, 35756.75634, 35756.75634, 35756.75634, 
                                                                                                                                                                                           36789.823003125, 36789.823003125, 36789.823003125, 37822.88966625, 
                                                                                                                                                                                           37822.88966625, 37822.88966625, 37822.88966625, 37822.88966625
                                                                                                              ), `24 UMAS-SALARIO DIARIO: $2,085.12` = c(7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7048.45144987372, 
                                                                                                                                                         7383.76014535507, 8029.12738892906, 8377.52781833756, 8734.60482516064, 
                                                                                                                                                         9095.07041302107, 9442.86744563545, 9798.18454514232, 10145.1770486979, 
                                                                                                                                                         10504.2347107053, 10859.5518102122, 11602.6120688319, 11975.1619282615, 
                                                                                                                                                         12331.3121401076, 13163.9427371405, 13537.0128981718, 13919.0332766294, 
                                                                                                                                                         14305.0753334809, 14678.1454945123, 15999.9419649495, 16393.5583642275, 
                                                                                                                                                         16795.9917078163, 17203.3907464033, 18197.759457023, 18614.2578746745, 
                                                                                                                                                         19021.6311951826, 20099.8644306271, 20515.6818745785, 20951.5581640795, 
                                                                                                                                                         21387.4344535806, 21803.251897532, 23545.0614429181, 23986.4625415836, 
                                                                                                                                                         24436.7264097241, 24893.7409707268, 26130.5097061122, 26595.4821939453, 
                                                                                                                                                         27051.3023951672, 28393.8975244652, 28856.9450901144, 29108.69828388, 
                                                                                                                                                         29108.69828388, 29108.69828388, 30725.84818854, 30725.84818854, 
                                                                                                                                                         30725.84818854, 30725.84818854, 31668.00498531, 31668.00498531, 
                                                                                                                                                         31668.00498531, 32610.16178208, 32610.16178208, 32610.16178208, 
                                                                                                                                                         32610.16178208, 32610.16178208, 34326.4860864, 34326.4860864, 
                                                                                                                                                         34326.4860864, 34326.4860864, 35318.230083, 35318.230083, 35318.230083, 
                                                                                                                                                         36309.9740796, 36309.9740796, 36309.9740796, 36309.9740796, 36309.9740796
                                                                                                              ), `23 UMAS-SALARIO DIARIO: $1,998.24` = c(7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                         7003.69300000001, 7003.69300000001, 7003.69300000001, 7003.69300000001, 
                                                                                                                                                         7104.59336635489, 7723.47670814679, 8056.79568949038, 8398.28853331304, 
                                                                                                                                                         8743.16995817307, 9075.88554272253, 9415.61847922899, 9747.52953471962, 
                                                                                                                                                         10091.0030337267, 10430.7359702331, 11143.0778018779, 11499.45789709, 
                                                                                                                                                         11839.959950016, 12638.0404607611, 12994.8957520171, 13360.1607650402, 
                                                                                                                                                         13729.4474564573, 14086.3027477133, 15353.3064707014, 15729.6945708431, 
                                                                                                                                                         16114.3253386578, 16503.9218014707, 17456.6079408016, 17854.6815813858, 
                                                                                                                                                         18244.224472474, 19277.157849191, 19674.5427334388, 20091.3720445795, 
                                                                                                                                                         20508.2013557202, 20905.586239968, 22574.4245342924, 22996.3088050365, 
                                                                                                                                                         23426.4052843248, 23863.2524564754, 25047.5478146039, 25491.6941122157, 
                                                                                                                                                         25927.3599358041, 27212.9160512335, 27655.171689537, 27895.835855385, 
                                                                                                                                                         27895.835855385, 27895.835855385, 29445.6045140175, 29445.6045140175, 
                                                                                                                                                         29445.6045140175, 29445.6045140175, 30348.5047775888, 30348.5047775888, 
                                                                                                                                                         30348.5047775888, 31251.40504116, 31251.40504116, 31251.40504116, 
                                                                                                                                                         31251.40504116, 31251.40504116, 32896.2158328, 32896.2158328, 
                                                                                                                                                         32896.2158328, 32896.2158328, 33846.637162875, 33846.637162875, 
                                                                                                                                                         33846.637162875, 34797.05849295, 34797.05849295, 34797.05849295, 
                                                                                                                                                         34797.0584929501, 34797.0584929501), `25 UMAS-SALARIO DIARIO: $2,172.00...7` = c(-42185.416962, 
                                                                                                                                                                                                                                          -49531.506492, -57237.788556, -64807.083666, -72744.011496, -80796.262209, 
                                                                                                                                                                                                                                          -88700.365689, -96983.262168, -105110.571228, -113624.113473, 
                                                                                                                                                                                                                                          -122252.978601, -130150.954869, -139010.465763, -147695.788773, 
                                                                                                                                                                                                                                          -156785.945433, -165694.474023, -175015.276449, -184451.401758, 
                                                                                                                                                                                                                                          -193694.738718, -203361.509793, -212828.052333, -222725.469174, 
                                                                                                                                                                                                                                          -233822.46686712, -243961.0037052, -255313.6232964, -266423.7173676, 
                                                                                                                                                                                                                                          -278031.95885688, -289389.42895848, -301253.29234584, -313244.96668224, 
                                                                                                                                                                                                                                          -324973.50082944, -337220.79706392, -349196.70724152, -361699.62537408, 
                                                                                                                                                                                                                                          -375563.33803968, -388663.85438784, -402808.14219072, -416631.92480832, 
                                                                                                                                                                                                                                          -431056.78774848, -445152.09469248, -507468.180614859, -523522.436423861, 
                                                                                                                                                                                                                                          -531508.446023861, -539760.655943861, -547746.665543861, -555998.875463861, 
                                                                                                                                                                                                                                          -564985.677503861, -573102.789023861, -582089.591063861, -590786.496263861, 
                                                                                                                                                                                                                                          -599773.298303861, -608470.203503861, -617457.005543861, -626443.807583861, 
                                                                                                                                                                                                                                          -635140.712783861, -644127.514823861, -652824.420023861, -661811.222063861, 
                                                                                                                                                                                                                                          -671532.616223861, -680313.230303861, -690034.624463861, -699442.425263861, 
                                                                                                                                                                                                                                          -709163.819423861, -718571.620223861, -728293.014383861, -738014.408543861, 
                                                                                                                                                                                                                                          -747422.209343861, -757143.603503861, -766551.404303861, -776272.798463861, 
                                                                                                                                                                                                                                          -786728.111423861, -796171.619903861, -806626.932863861, -816744.977663861, 
                                                                                                                                                                                                                                          -827200.290623861, -837318.335423861, -847773.648383861, -858228.961343861, 
                                                                                                                                                                                                                                          -868347.006143861), `24 UMAS-SALARIO DIARIO: $2,085.12...8` = c(-40498.00028352, 
                                                                                                                                                                                                                                                                                                          -47550.24623232, -54948.27701376, -62214.80031936, -69834.25103616, 
                                                                                                                                                                                                                                                                                                          -77564.41172064, -85152.35106144, -93103.93168128, -100906.14837888, 
                                                                                                                                                                                                                                                                                                          -109079.14893408, -117362.85945696, -124944.91667424, -133450.04713248, 
                                                                                                                                                                                                                                                                                                          -141787.95722208, -150514.50761568, -159066.69506208, -168014.66539104, 
                                                                                                                                                                                                                                                                                                          -177073.34568768, -185946.94916928, -195227.04940128, -204314.93023968, 
                                                                                                                                                                                                                                                                                                          -213816.45040704, -224469.568192435, -234202.563556992, -245101.078364544, 
                                                                                                                                                                                                                                                                                                          -255766.768672896, -266910.680502605, -277813.851800141, -289203.160652006, 
                                                                                                                                                                                                                                                                                                          -300715.16801495, -311974.560796262, -323731.965181363, -335228.838951859, 
                                                                                                                                                                                                                                                                                                          -347231.640359117, -360540.804518093, -373117.300212326, -386695.816503091, 
                                                                                                                                                                                                                                                                                                          -399966.647815987, -413814.516238541, -427346.010904781, -487169.453390265, 
                                                                                                                                                                                                                                                                                                          -502581.538966906, -510248.108182906, -518170.229706106, -525836.798922106, 
                                                                                                                                                                                                                                                                                                          -533758.920445306, -542386.250403706, -550178.677462906, -558806.007421306, 
                                                                                                                                                                                                                                                                                                          -567155.036413306, -575782.366371706, -584131.395363706, -592758.725322106, 
                                                                                                                                                                                                                                                                                                          -601386.055280506, -609735.084272506, -618362.414230906, -626711.443222906, 
                                                                                                                                                                                                                                                                                                          -635338.773181306, -644671.311574906, -653100.701091706, -662433.239485306, 
                                                                                                                                                                                                                                                                                                          -671464.728253306, -680797.266646907, -689828.755414907, -699161.293808507, 
                                                                                                                                                                                                                                                                                                          -708493.832202107, -717525.320970107, -726857.859363707, -735889.348131707, 
                                                                                                                                                                                                                                                                                                          -745221.886525307, -755258.986966907, -764324.755107707, -774361.855549307, 
                                                                                                                                                                                                                                                                                                          -784075.178557307, -794112.278998907, -803825.602006907, -813862.702448507, 
                                                                                                                                                                                                                                                                                                          -823899.802890107, -833613.125898107), `23 UMAS-SALARIO DIARIO: $1,998.24...9` = c(-38810.58360504, 
                                                                                                                                                                                                                                                                                                                                                                                             -45568.98597264, -52658.76547152, -59622.51697272, -66924.49057632, 
                                                                                                                                                                                                                                                                                                                                                                                             -74332.56123228, -81604.33643388, -89224.60119456, -96701.72552976, 
                                                                                                                                                                                                                                                                                                                                                                                             -104534.18439516, -112472.74031292, -119738.87847948, -127889.62850196, 
                                                                                                                                                                                                                                                                                                                                                                                             -135880.12567116, -144243.06979836, -152438.91610116, -161014.05433308, 
                                                                                                                                                                                                                                                                                                                                                                                             -169695.28961736, -178199.15962056, -187092.58900956, -195801.80814636, 
                                                                                                                                                                                                                                                                                                                                                                                             -204907.43164008, -215116.66951775, -224444.123408784, -234888.533432688, 
                                                                                                                                                                                                                                                                                                                                                                                             -245109.819978192, -255789.40214833, -266238.274641802, -277153.028958173, 
                                                                                                                                                                                                                                                                                                                                                                                             -288185.369347661, -298975.620763085, -310243.133298806, -321260.970662198, 
                                                                                                                                                                                                                                                                                                                                                                                             -332763.655344154, -345518.270996506, -357570.746036813, -370583.490815463, 
                                                                                                                                                                                                                                                                                                                                                                                             -383301.370823655, -396572.244728602, -409539.927117082, -466870.726165671, 
                                                                                                                                                                                                                                                                                                                                                                                             -481640.641509952, -488987.770341952, -496579.803468352, -503926.932300352, 
                                                                                                                                                                                                                                                                                                                                                                                             -511518.965426752, -519786.823303552, -527254.565901952, -535522.423778752, 
                                                                                                                                                                                                                                                                                                                                                                                             -543523.576562752, -551791.434439552, -559792.587223552, -568060.445100352, 
                                                                                                                                                                                                                                                                                                                                                                                             -576328.302977152, -584329.455761152, -592597.313637952, -600598.466421952, 
                                                                                                                                                                                                                                                                                                                                                                                             -608866.324298752, -617810.006925952, -625888.171879552, -634831.854506752, 
                                                                                                                                                                                                                                                                                                                                                                                             -643487.031242752, -652430.713869952, -661085.890605952, -670029.573233152, 
                                                                                                                                                                                                                                                                                                                                                                                             -678973.255860352, -687628.432596352, -696572.115223552, -705227.291959552, 
                                                                                                                                                                                                                                                                                                                                                                                             -714170.974586752, -723789.862509953, -732477.890311553, -742096.778234753, 
                                                                                                                                                                                                                                                                                                                                                                                             -751405.379450753, -761024.267373953, -770332.868589953, -779951.756513153, 
                                                                                                                                                                                                                                                                                                                                                                                             -789570.644436353, -798879.245652353), UMAS = c("25 UMAS-SALARIO DIARIO: $2,172.00", 
                                                                                                                                                                                                                                                                                                                                                                                                                                             "24 UMAS-SALARIO DIARIO: $2,085.12", "23 UMAS-SALARIO DIARIO: $1,998.24", 
                                                                                                                                                                                                                                                                                                                                                                                                                                             NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
                                                                                                                                                                                                                                                                                                                                                                                                                                             NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
                                                                                                                                                                                                                                                                                                                                                                                                                                             NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
                                                                                                                                                                                                                                                                                                                                                                                                                                             NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
                                                                                                                                                                                                                                                                                                                                                                                                                                             NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)), class = c("tbl_df", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         "tbl", "data.frame"), row.names = c(NA, -79L))

tpension <- todo %>%
  select(c(1:6))

tinversion <- todo %>%
  select(c(1:3,7:9)) %>%
  rename('25 UMAS-SALARIO DIARIO: $2,172.00' = "25 UMAS-SALARIO DIARIO: $2,172.00...7",
         '24 UMAS-SALARIO DIARIO: $2,085.12' = '24 UMAS-SALARIO DIARIO: $2,085.12...8',
         '23 UMAS-SALARIO DIARIO: $1,998.24' = '23 UMAS-SALARIO DIARIO: $1,998.24...9')

tumas <- todo %>%
  select(10) %>%
  filter(!is.na(UMAS))

ui <- fluidPage(
  
  # App title ----
  titlePanel("Ejemplo Pensión"),
  # shinythemes::themeSelector(),
  theme = shinythemes::shinytheme('simplex'),
  
  # Sidebar layout with input and output definitions ----
  sidebarLayout(
    
    # Sidebar to demonstrate various slider options ----
    sidebarPanel(
      # Input: Simple integer interval ----
      sliderInput("meses", "Meses en Mod.40: ",
                  min = min(todo$'MESES'), max = max(todo$'MESES'),
                  value = c(min(todo$'MESES'), max(todo$'MESES')), step = 1),
      
      # Input: Decimal interval with step value ----
      checkboxGroupInput("umas", "UMAS Seleccionadas (Salario asignado):", 
                         choices = unique(tumas$UMAS), selected = colnames(todo)[4])
    ),
    
    # Main panel for displaying outputs ----
    mainPanel(
      DT::DTOutput("inversion"),
      DT::DTOutput("pension"),
      # Creating tabs 
      tabsetPanel(
        tabPanel('Grafica de linea de Inversión',
                 plotly::plotlyOutput("graficaInversion")),
        tabPanel('Grafica de barra de Pensión',
                 plotly::plotlyOutput("graficaPension"))
      )
    )
  )
)

# Define server logic for slider examples ----
server <- function(input, output) {
  # Reactive expression to create data frame of all input values ----
  filtrosPension <- reactive({
    tpension %>% 
      select(1:3, input$umas) %>%
      filter(MESES >= input$meses[1]) %>% 
      filter(MESES <= input$meses[2])   
  })
  
  filtrosInversion <- reactive({
    tinversion %>% 
      select(1:3, input$umas) %>%
      filter(MESES >= input$meses[1]) %>% 
      filter(MESES <= input$meses[2])   
  })
  
  columnas <- reactive({
    c(4:(3 +nrow(as.array(input$umas))))
  })
  
  tinversionl <- reactive({
    tinversion %>%
    pivot_longer(!c('MESES', 'FECHA SOLICITUD', 'EDAD AL PENSIONARSE'), 
                 names_to = 'UMAS', values_to = 'INVERSION') %>%
    filter(MESES >= input$meses[1]) %>%
    filter(MESES <= input$meses[2]) %>%
    filter(UMAS %in% input$umas) %>%
    mutate(INVERSION = INVERSION * -1)
  })
  
  tpensionl <- reactive({
    tpension %>%
      pivot_longer(!c('MESES', 'FECHA SOLICITUD', 'EDAD AL PENSIONARSE'), 
                   names_to = 'UMAS', values_to = 'PENSION') %>%
      filter(MESES >= input$meses[1]) %>%
      filter(MESES <= input$meses[2]) %>%
      filter(UMAS %in% input$umas)
  })
  
  # Show the values in an HTML table ----
  output$pension <- DT::renderDT({
    DT::datatable(filtrosPension(), rownames = FALSE, options = list(pageLength = 5)) %>%
    DT::formatDate(
        columns = 2, 
        method =  "toLocaleDateString", 
        params = list(
          'es-ES', 
          list(year = 'numeric', month = 'short', day = 'numeric'))) %>%
      DT::formatRound(columns = 3, digits = 1) %>%
      DT::formatCurrency(columns = columnas()) %>%
      DT::formatStyle(columnas(), backgroundColor = styleInterval(0, c("#f4cccc", '#d2f2cd')), fontWeight = 'bold')
    })
  
  output$inversion <- DT::renderDT({
    DT::datatable(filtrosInversion(), rownames = FALSE, options = list(pageLength = 5)) %>%
      DT::formatDate(
        columns = 2, 
        method =  "toLocaleDateString", 
        params = list(
          'es-ES', 
          list(year = 'numeric', month = 'short', day = 'numeric'))) %>%
      DT::formatRound(columns = 3, digits = 1) %>%
      DT::formatCurrency(columns = columnas()) %>%
      DT::formatStyle(columnas(), backgroundColor = styleInterval(0, c("#f4cccc", '#d2f2cd')), fontWeight = 'bold')
  })
  
  output$graficaInversion <- plotly::renderPlotly({
    ggplot(tinversionl()) + geom_line(aes(x = MESES, y = INVERSION, color = UMAS))} + 
      scale_y_continuous(labels = scales::dollar) + scale_x_continuous(breaks = seq(input$meses[1], input$meses[2], by = 3)) + xlab("Meses cotizando en Mod. 40") + ylab("Inversión") + ggtitle("Inversión requerida respecto a los meses en Mod. 40"))
    
  
  output$graficaPension <- plotly::renderPlotly({
    ggplot(tpensionl()) + geom_bar(aes(x = `FECHA SOLICITUD`, y = PENSION, fill = UMAS), stat = 'identity', position = 'dodge')} + 
      scale_y_continuous(labels = scales::dollar) + scale_x_datetime(date_labels = "%b %y", date_breaks = "24 week") + xlab("Meses cotizando en Mod. 40") + ylab("Pensión") + ggtitle("Pensión alcanzada respecto a los meses en Mod. 40"))

  
  }
# Create Shiny app ----
shinyApp(ui, server)